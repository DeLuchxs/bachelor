\chapter{Grundlagen}

\printmyminitoc{1}

\section{CAN-Bus}
Bei einem Can-Bus handelt es sich um eine serielle Netzwerktechnologie, 
welche mehrere Geräte mit einem Draht verbindet.
Die Entwicklung des Can-Bus wurde von Bosch im Jahr 1983 begonnen. 1986 wurde der erste Can-Bus Standard 
veröffentlicht.
Die Motivation der Entwicklung war die effiziente Kommunikation zwischen den Steuergeräten in einem Auto. 
Als günstige
Nebenwirkung konnte damit die Kabelmenge reduziert werden, da alle Geräte mit einem Bus verbunden werden können.
Durch die höhere Zuverlässigkeit und Funktionalität des Can-Bus, wurde dieser schnell in der Autoindustrie etabliert.
Aber auch in anderen Sektoren, wie z.B. der Medizintechnik, der Gebäudeautomation oder der Luftfahrt, spielt der
Can-Bus mittlwerweile eine wichtige Rolle.
\cite[Seiten 2-10]{Voss2008}
\\
Man sprich von einem Bussystem, da alle Geräte gleichberechtigt sind. Dass heißt, dass jedes Gerät Nachrichten 
senden und empfangen kann.
Die Nachrichten werden nach Broadcasting-Prinzip übertragen. Jede Nachricht wird von allen Knoten empfangen, 
aber nur die Knoten, die die Nachricht benötigen, verarbeiten sie. Diese werden nicht Einhaltung der Protokollregeln 
überprüft,
da dies zu einer größeren unnötigen Last auf dem Bus führen würde. 
Jedoch wird die Integrität der Nachrichten durch eine Prüfsumme sichergestellt. Das wird auch mit 
einer Acknowledge-Nachricht(ACK) bestätigt. Wird eine Nachricht nicht bestätigt, wird von dem Sender eine Fehlermeldung
auf den Bus gesendet.
Bei einer fehlerhaften Nachricht reagieren
die Knoten mit einer Fehlermeldung, die wieder der gesamte Bus empfängt. Wenn ein Knoten dauerhaft fehlerhafte
Nachrichten sendet, wird dieser vom Bus getrennt. Die auf dem Bus gesendeten Daten werden mit einer Nachrichten-ID
versehen, die die Priorität der Nachricht angibt. Die Nachrichten mit der niedrigsten ID haben die höchste Priorität.
Die Maximale Länge einer Nachricht beträgt 8 Byte. Durch die vergleichsweise geringe Länge der Nachrichten, kann 
eine geringe Latenz erreicht werden. Dabei kann eine höchste Baudrate von 1Mbit/s gesetzt werden.
\cite[Seiten 13-19]{Voss2008}
\\
Alle Knoten in einem Can-Bus sind mit einem Zweiadrigen Kabel verbunden. Diese werden als High(CAN\_H) und Low(CAN\_L) 
bezeichnet. Der Bus ist an beiden Enden mit einem Widerstand von 120 Ohm abgeschlossen um Reflexionen zu vermeiden.
\cite[Seite 132]{Voss2008}
\\


Data-Frames eines Can-Bus:
\begin{itemize}
    \item Start of Frame (SOF): Startbit
    \item Arbitration Field: Identifier
    \item Control Field: wird zur Datengröße und Nachrichtslänge verwendet
    \item Data Field: eigentliche Nutzdaten
    \item CRC Field: Prüfsumme
    \item End of Frame (EOF): Stopbit
\end{itemize}
\cite[Seite 36]{Voss2008}

Erweitertes Can-Protokoll: 
Standard Can-Protokoll hat 11 Bit Identifier, erweitertes Can-Protokoll hat 29 Bit Identifier.
Higher-Layer-Protokolle SAE J1939 wurde für die Kommunikation in Nutzfahrzeugen entwickelt.
SAE = Society of Automotive Engineers\\
Identifier wurde mit J1939 auf 29 Bit erweitert um mehr verschiedene Nachrichten zu ermöglichen.\\
Auf einem Can-Bus können der Standard 11 Bit Identifier und der erweiterte 29 Bit Identifier gleichzeitig verwendet werden.
Wenn zwei Nachrichten den gleichen 11 Bit Identifier haben, wird die Nachricht mit dem 11 Bit Identifier bevorzugt immer die
höhere Priorität haben. Die spezifierten Baudraten sind hier 250kbit/s und 500kbit/s. Die Hauptkomponenten des
erweiterten Identifier sind die Priorität, eine Parameter Group Number (PGN) und eine Quell-Adresse.
Das PGN-Feld ist aus 2 Bit Data Page, einer Protocol Data Unit (PDU) und einem PDU spezifischen Feld 
aufgebaut.
Jedes Gerät an dem Can-Bus muss eine valide Adresse und einen einzigartigen Namen haben. Vor 
der Kommunikation in einem Netzwerk muss ein Gerät sich einen Namen und eine Adresse geben.
\cite{Murvay2018}



\section{Raspberry Pi}
\begin{itemize}
    \item Ein Raspberry Pi ist ein Einplatinencomputer, der von der Raspberry Pi Foundation entwickelt wurde.
    \item Der Raspberry Pi ist ein vollwertiger Computer, der auf einem einzigen Board integriert ist. (vergleichsweise günstig, aber leistungsschwach)
    \item eignet sich gut um einfache Aufgaben zu erledigen, wie z.B. das Ausführen von Programmen, das Anzeigen von Informationen auf einem Bildschirm oder das Steuern von Geräten.
    \item Der benutzte Raspberry Pi 5 hat folgende Anschlüsse: 4 $\cdot$ USB, 2$\cdot$Micro-HDMI, 1$\cdot$Ethernet, 1$\cdot$USB-C für Stromversorgung, 1$\cdot$Micro-SD-Kartensteckplatz
\end{itemize}

\subsection{Raspberry Pi als Rogue Device}
Unter einem Rogue Device versteht man ein Gerät, welches sich unautorisiert und unauffällig in ein Netzwerk einbindet. \cite{Scarfone2008}
Dies kann ein Raspberry Pi sein, der sich in ein Netzwerk einbindet und Daten abgreift oder manipuliert. Hierüber können 
sich Angreifer Zugriff auf das Netzwerk verschaffen. 
\begin{itemize}
    \item eigener Code kann auf Rogue Device laufen
    \item kann von Angreifern von außen gesteuert werden
    \item kann auch genuzt werden um Informationen über das Netzwerk zu sammeln
\end{itemize}

\section{State of the Art}
\begin{itemize}
    \item Was gibt es schon für Lösungen?
    \item Was ist der aktuelle Stand der Technik?
    \item Was ist der aktuelle Stand der Forschung?
\end{itemize}
\subsection{Anbindung von Raspberry Pi an CanBus}
\begin{itemize}
    \item Raspbian OS hat seit 05.05.2015 eingebundenen Support für den Mikrochip MCP251x
\end{itemize}
\cite{Salunkhe2016}
\begin{itemize}
    \item PiCan2 ist ein CanBus Board für den Raspberry Pi
    \item HAT (Hardware Attached on Top) Standard
    \item erlaubt dem Raspberry Pi mit dem CanBus zu kommunizieren mit einer Geschwindigkeit von bis zu 1Mbit/s
    \item UCAN ist ein USB-CAN Adapter, der es ermöglicht ein beliebiges USB-Gerät mit dem CanBus zu verbinden
\end{itemize}
\cite{Pant2019}
\subsection{Übersetzung von CanBus Nachrichten}
\begin{itemize}
    \item J1939 (DBC-Dateien) (https://docs.fileformat.com/de/database/dbc/)
    \item NMEA 0183 
    \item NMEA 2000 $\rightarrow$ CanBoat (https://github.com/canboat/canboat)
    \item cantools Python Library 
\end{itemize}